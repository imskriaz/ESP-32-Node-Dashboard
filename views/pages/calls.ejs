<!-- Call Management -->
<div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4 gap-3">
    <div>
        <h2 class="mb-1">
            <i class="bi bi-telephone me-2"></i>Call Management
        </h2>
        <p class="text-muted mb-0">Make calls, view history, manage contacts</p>
    </div>
    <div class="d-flex gap-2">
        <button class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#contactsModal">
            <i class="bi bi-person-lines-fill me-2"></i>
            <span class="d-none d-md-inline">Contacts</span>
        </button>
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#dialerModal">
            <i class="bi bi-telephone-plus me-2"></i>
            <span class="d-none d-md-inline">New Call</span>
        </button>
    </div>
</div>

<!-- Active Call Banner -->
<div id="activeCallBanner" class="alert alert-success d-none mb-4" role="alert">
    <div class="d-flex flex-column flex-sm-row align-items-start align-items-sm-center justify-content-between gap-3">
        <div class="d-flex align-items-center">
            <div class="spinner-grow spinner-grow-sm text-success me-3" role="status">
                <span class="visually-hidden">Active</span>
            </div>
            <div>
                <strong id="activeCallStatus">Active Call</strong>
                <span class="mx-2">|</span>
                <span id="activeCallNumber">+8801712345678</span>
                <span class="mx-2">|</span>
                <span id="activeCallDuration">00:00</span>
            </div>
        </div>
        <div class="d-flex gap-2 w-100 w-sm-auto">
            <button class="btn btn-sm btn-outline-success flex-fill" onclick="muteCall()">
                <i class="bi bi-mic-mute"></i> Mute
            </button>
            <button class="btn btn-sm btn-outline-primary flex-fill" onclick="holdCall()">
                <i class="bi bi-pause"></i> Hold
            </button>
            <button class="btn btn-sm btn-danger flex-fill" onclick="endCall()">
                <i class="bi bi-telephone-x"></i> End
            </button>
        </div>
    </div>
</div>

<!-- Stats Cards -->
<div class="row g-3 mb-4">
    <div class="col-6 col-md-3">
        <div class="card bg-primary bg-opacity-10 border-0">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-shrink-0">
                        <i class="bi bi-telephone fs-2 text-primary"></i>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <h6 class="mb-1">Total Calls</h6>
                        <h4 class="mb-0" id="totalCalls">0</h4>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-6 col-md-3">
        <div class="card bg-success bg-opacity-10 border-0">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-shrink-0">
                        <i class="bi bi-telephone-outbound fs-2 text-success"></i>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <h6 class="mb-1">Outgoing</h6>
                        <h4 class="mb-0" id="outgoingCalls">0</h4>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-6 col-md-3">
        <div class="card bg-info bg-opacity-10 border-0">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-shrink-0">
                        <i class="bi bi-telephone-inbound fs-2 text-info"></i>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <h6 class="mb-1">Incoming</h6>
                        <h4 class="mb-0" id="incomingCalls">0</h4>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-6 col-md-3">
        <div class="card bg-warning bg-opacity-10 border-0">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-shrink-0">
                        <i class="bi bi-telephone-x fs-2 text-warning"></i>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <h6 class="mb-1">Missed</h6>
                        <h4 class="mb-0" id="missedCalls">0</h4>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Search and Filter Bar -->
<div class="card mb-4">
    <div class="card-body">
        <div class="row g-2">
            <div class="col-12 col-md-6">
                <div class="input-group">
                    <span class="input-group-text bg-white">
                        <i class="bi bi-search"></i>
                    </span>
                    <input type="text" class="form-control" id="searchCalls" placeholder="Search calls...">
                </div>
            </div>
            <div class="col-6 col-md-3">
                <select class="form-select" id="filterCallType">
                    <option value="all">All Calls</option>
                    <option value="incoming">Incoming</option>
                    <option value="outgoing">Outgoing</option>
                    <option value="missed">Missed</option>
                    <option value="answered">Answered</option>
                </select>
            </div>
            <div class="col-6 col-md-3">
                <select class="form-select" id="sortCalls">
                    <option value="newest">Newest First</option>
                    <option value="oldest">Oldest First</option>
                    <option value="duration">Longest First</option>
                </select>
            </div>
        </div>
    </div>
</div>

<!-- Call Tabs -->
<ul class="nav nav-tabs nav-fill mb-4" id="callTabs" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active" id="recent-tab" data-bs-toggle="tab" data-bs-target="#recent" type="button" role="tab">
            <i class="bi bi-clock-history me-2"></i>Recent
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="contacts-tab" data-bs-toggle="tab" data-bs-target="#contacts" type="button" role="tab">
            <i class="bi bi-person-lines-fill me-2"></i>Contacts
            <span class="badge bg-primary ms-2" id="contactCount">0</span>
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="dialer-tab" data-bs-toggle="tab" data-bs-target="#dialer" type="button" role="tab">
            <i class="bi bi-dialpad me-2"></i>Speed Dial
        </button>
    </li>
</ul>

<!-- Tab Content -->
<div class="tab-content" id="callTabContent">
    <!-- Recent Calls Tab -->
    <div class="tab-pane fade show active" id="recent" role="tabpanel">
        <div class="card">
            <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="bi bi-clock-history me-2"></i>Call History
                </h5>
                <div>
                    <button class="btn btn-sm btn-outline-secondary me-2" onclick="refreshCalls()">
                        <i class="bi bi-arrow-repeat"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-danger" onclick="clearAllCalls()">
                        <i class="bi bi-trash"></i> Clear All
                    </button>
                </div>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive d-none d-md-block">
                    <table class="table table-hover align-middle mb-0" id="callsTable">
                        <thead class="table-light">
                            <tr>
                                <th>Type</th>
                                <th>Contact</th>
                                <th>Number</th>
                                <th>Date & Time</th>
                                <th>Duration</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="callsTableBody">
                            <tr>
                                <td colspan="7" class="text-center py-4">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- Mobile view -->
                <div class="d-block d-md-none" id="callsMobileList">
                    <div class="text-center py-4">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Pagination -->
            <div class="card-footer bg-white py-3">
                <nav aria-label="Call history pagination">
                    <ul class="pagination pagination-sm justify-content-center mb-0" id="callsPagination">
                        <!-- Populated by JavaScript -->
                    </ul>
                </nav>
            </div>
        </div>
    </div>
    
    <!-- Contacts Tab -->
    <div class="tab-pane fade" id="contacts" role="tabpanel">
        <div class="card">
            <div class="card-header bg-white py-3">
                <div class="row g-2 align-items-center">
                    <div class="col-12 col-md-6">
                        <h5 class="mb-0">
                            <i class="bi bi-person-lines-fill me-2"></i>Contacts
                        </h5>
                    </div>
                    <div class="col-12 col-md-6">
                        <div class="input-group">
                            <span class="input-group-text bg-white">
                                <i class="bi bi-search"></i>
                            </span>
                            <input type="text" class="form-control" id="contactSearch" placeholder="Search contacts...">
                            <button class="btn btn-primary" type="button" data-bs-toggle="modal" data-bs-target="#addContactModal">
                                <i class="bi bi-plus-lg"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-body p-0">
                <!-- Contact groups -->
                <div class="px-3 py-2 bg-light border-bottom">
                    <div class="d-flex gap-2 flex-wrap" id="contactGroupFilters">
                        <span class="badge bg-primary cursor-pointer" onclick="filterContactsByGroup('')">All</span>
                        <span class="badge bg-secondary cursor-pointer" onclick="filterContactsByGroup('work')">Work</span>
                        <span class="badge bg-success cursor-pointer" onclick="filterContactsByGroup('family')">Family</span>
                        <span class="badge bg-info cursor-pointer" onclick="filterContactsByGroup('friends')">Friends</span>
                        <span class="badge bg-warning cursor-pointer" onclick="filterContactsByGroup('service')">Service</span>
                        <span class="badge bg-danger cursor-pointer" onclick="filterContactsByGroup('emergency')">Emergency</span>
                    </div>
                </div>
                
                <!-- Contacts list -->
                <div class="list-group list-group-flush" id="contactsList" style="max-height: 500px; overflow-y: auto;">
                    <!-- Populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Speed Dial Tab -->
    <div class="tab-pane fade" id="dialer" role="tabpanel">
        <div class="row g-4">
            <!-- Speed Dial Grid -->
            <div class="col-12 col-lg-8">
                <div class="card">
                    <div class="card-header bg-white py-3">
                        <h5 class="mb-0">
                            <i class="bi bi-stars me-2"></i>Speed Dial
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3" id="speedDialGrid">
                            <!-- Populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Favorites -->
            <div class="col-12 col-lg-4">
                <div class="card">
                    <div class="card-header bg-white py-3">
                        <h5 class="mb-0">
                            <i class="bi bi-star-fill text-warning me-2"></i>Favorites
                        </h5>
                    </div>
                    <div class="card-body p-0">
                        <div class="list-group list-group-flush" id="favoritesList">
                            <!-- Populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Dialer Modal -->
<div class="modal fade" id="dialerModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-dialpad me-2"></i>Dial Number
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Number Display -->
                <div class="mb-4">
                    <input type="tel" class="form-control form-control-lg text-center" 
                           id="dialerNumber" placeholder="Enter number" readonly>
                    <div class="d-flex justify-content-between mt-2">
                        <small class="text-muted" id="numberHint">Enter 10-digit number</small>
                        <small class="text-muted" id="contactName"></small>
                    </div>
                </div>

                <!-- Dialer Pad -->
                <div class="dialer-grid mb-4">
                    <div class="row g-2">
                        <!-- Row 1 -->
                        <div class="col-4">
                            <button class="btn btn-outline-secondary w-100 py-3 dialer-btn" data-number="1">
                                <span class="fs-4 fw-bold">1</span>
                            </button>
                        </div>
                        <div class="col-4">
                            <button class="btn btn-outline-secondary w-100 py-3 dialer-btn" data-number="2">
                                <span class="fs-4 fw-bold">2</span>
                                <small class="d-block text-muted">ABC</small>
                            </button>
                        </div>
                        <div class="col-4">
                            <button class="btn btn-outline-secondary w-100 py-3 dialer-btn" data-number="3">
                                <span class="fs-4 fw-bold">3</span>
                                <small class="d-block text-muted">DEF</small>
                            </button>
                        </div>

                        <!-- Row 2 -->
                        <div class="col-4">
                            <button class="btn btn-outline-secondary w-100 py-3 dialer-btn" data-number="4">
                                <span class="fs-4 fw-bold">4</span>
                                <small class="d-block text-muted">GHI</small>
                            </button>
                        </div>
                        <div class="col-4">
                            <button class="btn btn-outline-secondary w-100 py-3 dialer-btn" data-number="5">
                                <span class="fs-4 fw-bold">5</span>
                                <small class="d-block text-muted">JKL</small>
                            </button>
                        </div>
                        <div class="col-4">
                            <button class="btn btn-outline-secondary w-100 py-3 dialer-btn" data-number="6">
                                <span class="fs-4 fw-bold">6</span>
                                <small class="d-block text-muted">MNO</small>
                            </button>
                        </div>

                        <!-- Row 3 -->
                        <div class="col-4">
                            <button class="btn btn-outline-secondary w-100 py-3 dialer-btn" data-number="7">
                                <span class="fs-4 fw-bold">7</span>
                                <small class="d-block text-muted">PQRS</small>
                            </button>
                        </div>
                        <div class="col-4">
                            <button class="btn btn-outline-secondary w-100 py-3 dialer-btn" data-number="8">
                                <span class="fs-4 fw-bold">8</span>
                                <small class="d-block text-muted">TUV</small>
                            </button>
                        </div>
                        <div class="col-4">
                            <button class="btn btn-outline-secondary w-100 py-3 dialer-btn" data-number="9">
                                <span class="fs-4 fw-bold">9</span>
                                <small class="d-block text-muted">WXYZ</small>
                            </button>
                        </div>

                        <!-- Row 4 -->
                        <div class="col-4">
                            <button class="btn btn-outline-secondary w-100 py-3 dialer-btn" data-number="*">
                                <span class="fs-4 fw-bold">*</span>
                            </button>
                        </div>
                        <div class="col-4">
                            <button class="btn btn-outline-secondary w-100 py-3 dialer-btn" data-number="0">
                                <span class="fs-4 fw-bold">0</span>
                                <small class="d-block text-muted">+</small>
                            </button>
                        </div>
                        <div class="col-4">
                            <button class="btn btn-outline-secondary w-100 py-3 dialer-btn" data-number="#">
                                <span class="fs-4 fw-bold">#</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="d-flex gap-2">
                    <button class="btn btn-outline-danger flex-fill" id="clearNumber">
                        <i class="bi bi-backspace"></i> Clear
                    </button>
                    <button class="btn btn-success flex-fill" id="makeCall">
                        <i class="bi bi-telephone"></i> Call
                    </button>
                </div>

                <!-- Quick Contacts -->
                <div class="mt-3">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <small class="text-muted">Quick Contacts</small>
                        <button class="btn btn-sm btn-link" onclick="loadMoreContacts()">View all</button>
                    </div>
                    <div class="d-flex gap-2 flex-wrap" id="quickContacts">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Contacts Modal (for full contact management) -->
<div class="modal fade" id="contactsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-person-lines-fill me-2"></i>Manage Contacts
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Search and filters -->
                <div class="row g-2 mb-3">
                    <div class="col-12 col-md-6">
                        <div class="input-group">
                            <span class="input-group-text bg-white">
                                <i class="bi bi-search"></i>
                            </span>
                            <input type="text" class="form-control" id="modalContactSearch" placeholder="Search contacts...">
                        </div>
                    </div>
                    <div class="col-6 col-md-3">
                        <select class="form-select" id="modalContactGroup">
                            <option value="">All Groups</option>
                            <option value="work">Work</option>
                            <option value="family">Family</option>
                            <option value="friends">Friends</option>
                            <option value="service">Service</option>
                            <option value="emergency">Emergency</option>
                            <option value="health">Health</option>
                        </select>
                    </div>
                    <div class="col-6 col-md-3">
                        <button class="btn btn-primary w-100" onclick="showAddContactModal()">
                            <i class="bi bi-person-plus"></i> Add New
                        </button>
                    </div>
                </div>

                <!-- Contacts list -->
                <div class="list-group" id="modalContactsList" style="max-height: 400px; overflow-y: auto;">
                    <!-- Populated by JavaScript -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Add/Edit Contact Modal -->
<div class="modal fade" id="addContactModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="contactModalTitle">
                    <i class="bi bi-person-plus me-2"></i>Add New Contact
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="contactForm">
                    <input type="hidden" id="contactId">
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold">Name *</label>
                        <input type="text" class="form-control" id="contactName" required>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold">Phone Number *</label>
                        <input type="tel" class="form-control" id="contactPhone" required>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold">Email</label>
                        <input type="email" class="form-control" id="contactEmail">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold">Company</label>
                        <input type="text" class="form-control" id="contactCompany">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold">Group</label>
                        <select class="form-select" id="contactGroup">
                            <option value="general">General</option>
                            <option value="work">Work</option>
                            <option value="family">Family</option>
                            <option value="friends">Friends</option>
                            <option value="service">Service</option>
                            <option value="emergency">Emergency</option>
                            <option value="health">Health</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="contactFavorite">
                            <label class="form-check-label" for="contactFavorite">Add to favorites</label>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold">Notes</label>
                        <textarea class="form-control" id="contactNotes" rows="2"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger d-none" id="deleteContactBtn">Delete</button>
                <button type="button" class="btn btn-primary" id="saveContactBtn">Save Contact</button>
            </div>
        </div>
    </div>
</div>

<!-- Load Calls page script -->
<script src="/js/calls.js"></script>

<style>
.dialer-btn {
    font-size: 1.1rem;
    transition: all 0.2s;
    min-height: 70px;
}

.dialer-btn:active {
    transform: scale(0.95);
    background-color: #e9ecef;
}

.dialer-btn small {
    font-size: 0.7rem;
    line-height: 1;
}

.contact-chip {
    background-color: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 2rem;
    padding: 0.5rem 1rem;
    cursor: pointer;
    transition: all 0.2s;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
}

.contact-chip:hover {
    background-color: #e9ecef;
    transform: translateY(-2px);
}

.contact-chip i {
    font-size: 1rem;
}

.speed-dial-card {
    cursor: pointer;
    transition: all 0.2s;
    text-align: center;
    padding: 1rem;
    border: 1px solid #dee2e6;
    border-radius: 0.5rem;
}

.speed-dial-card:hover {
    background-color: #f8f9fa;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.speed-dial-card i {
    font-size: 2rem;
    margin-bottom: 0.5rem;
}

.call-type-icon {
    font-size: 1.25rem;
}

.call-type-incoming {
    color: #28a745;
}

.call-type-outgoing {
    color: #007bff;
}

.call-type-missed {
    color: #dc3545;
}

#activeCallBanner {
    border-left: 4px solid #28a745;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.9; }
    100% { opacity: 1; }
}

@media (max-width: 767.98px) {
    .dialer-btn {
        min-height: 60px;
        padding: 0.75rem !important;
    }
    
    .dialer-btn small {
        font-size: 0.6rem;
    }
    
    .contact-chip {
        padding: 0.4rem 0.75rem;
        font-size: 0.9rem;
    }
}

.cursor-pointer {
    cursor: pointer;
}
</style>