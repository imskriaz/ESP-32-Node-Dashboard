<!-- Modem/Internet Management Page -->
<div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4 gap-3">
    <div>
        <h2 class="mb-1">
            <i class="bi bi-globe2 me-2"></i>Internet Connection Manager
        </h2>
        <p class="text-muted mb-0">Manage mobile data, WiFi connections, and internet sharing</p>
    </div>
    <button class="btn btn-outline-primary" onclick="refreshStatus()">
        <i class="bi bi-arrow-repeat"></i> Refresh
    </button>
</div>

<!-- Internet Status Overview -->
<div class="row g-3 mb-4">
    <div class="col-12">
        <div class="card bg-success bg-opacity-10 border-0" id="internetStatusCard">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-shrink-0">
                        <i class="bi bi-globe2 fs-1 text-success" id="internetIcon"></i>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <h4 class="mb-1" id="internetStatus">No Internet Connection</h4>
                        <p class="mb-0" id="internetDetails">Connect via Mobile Data or WiFi</p>
                    </div>
                    <div class="flex-shrink-0">
                        <span class="badge bg-primary p-2" id="activeSource">No Source</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Connection Sources Tabs -->
<ul class="nav nav-tabs nav-fill mb-4" id="internetTabs" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active" id="mobile-tab" data-bs-toggle="tab" data-bs-target="#mobile" type="button">
            <i class="bi bi-broadcast me-2"></i>Mobile Data
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="wifi-tab" data-bs-toggle="tab" data-bs-target="#wifi" type="button">
            <i class="bi bi-wifi me-2"></i>WiFi Client
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="hotspot-tab" data-bs-toggle="tab" data-bs-target="#hotspot" type="button">
            <i class="bi bi-share me-2"></i>Share Internet
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="routing-tab" data-bs-toggle="tab" data-bs-target="#routing" type="button">
            <i class="bi bi-diagram-3 me-2"></i>Routing
        </button>
    </li>
</ul>

<div class="tab-content">
    <!-- ==================== MOBILE DATA TAB ==================== -->
    <div class="tab-pane fade show active" id="mobile" role="tabpanel">
        <div class="row g-4">
            <!-- Mobile Status Card -->
            <div class="col-12 col-lg-6">
                <div class="card h-100">
                    <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="bi bi-broadcast me-2"></i>Mobile Data Status
                        </h5>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="mobileToggle">
                            <label class="form-check-label" for="mobileToggle">Enable</label>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="text-center mb-4">
                            <div class="display-1 mb-2">
                                <i class="bi bi-broadcast" id="mobileIcon"></i>
                            </div>
                            <h4 id="mobileStatus">Disabled</h4>
                        </div>
                        
                        <table class="table table-borderless">
                            <tr>
                                <td class="text-muted">Operator:</td>
                                <td class="fw-bold" id="mobileOperator">—</td>
                            </tr>
                            <tr>
                                <td class="text-muted">Network:</td>
                                <td class="fw-bold" id="mobileNetwork">—</td>
                            </tr>
                            <tr>
                                <td class="text-muted">Signal:</td>
                                <td>
                                    <div class="progress mb-1" style="height: 10px;">
                                        <div class="progress-bar" id="mobileSignalBar" style="width: 0%"></div>
                                    </div>
                                    <span id="mobileSignal">0%</span>
                                </td>
                            </tr>
                            <tr>
                                <td class="text-muted">IP Address:</td>
                                <td class="fw-bold" id="mobileIP">—</td>
                            </tr>
                            <tr>
                                <td class="text-muted">Data Used:</td>
                                <td class="fw-bold" id="mobileDataUsed">0 MB</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>

            <!-- APN Configuration -->
            <div class="col-12 col-lg-6">
                <div class="card h-100">
                    <div class="card-header bg-white py-3">
                        <h5 class="mb-0">
                            <i class="bi bi-gear me-2"></i>APN Configuration
                        </h5>
                    </div>
                    <div class="card-body">
                        <form id="apnForm" onsubmit="return false;">
                            <div class="mb-3">
                                <label class="form-label">APN</label>
                                <input type="text" class="form-control" id="apnName" value="internet">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Username (optional)</label>
                                <input type="text" class="form-control" id="apnUsername">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Password (optional)</label>
                                <input type="password" class="form-control" id="apnPassword">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Authentication</label>
                                <select class="form-select" id="apnAuth">
                                    <option value="none">None</option>
                                    <option value="pap">PAP</option>
                                    <option value="chap">CHAP</option>
                                </select>
                            </div>
                            <button type="button" class="btn btn-primary w-100" onclick="saveAPN()">
                                <i class="bi bi-save"></i> Save APN Settings
                            </button>
                        </form>
                        
                        <hr>
                        
                        <h6 class="fw-bold mb-3">Quick APN Presets</h6>
                        <div class="d-flex flex-wrap gap-2">
                            <button class="btn btn-sm btn-outline-secondary" onclick="setAPN('internet', '', '', 'none')">Generic</button>
                            <button class="btn btn-sm btn-outline-secondary" onclick="setAPN('gpinternet', '', '', 'none')">Grameenphone</button>
                            <button class="btn btn-sm btn-outline-secondary" onclick="setAPN('roblive', '', '', 'none')">Robi</button>
                            <button class="btn btn-sm btn-outline-secondary" onclick="setAPN('blink', '', '', 'none')">Banglalink</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== WIFI CLIENT TAB ==================== -->
    <div class="tab-pane fade" id="wifi" role="tabpanel">
        <div class="row g-4">
            <!-- WiFi Status -->
            <div class="col-12 col-lg-5">
                <div class="card h-100">
                    <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="bi bi-wifi me-2"></i>WiFi Status
                        </h5>
                        <div>
                            <span class="badge" id="wifiClientBadge">Disconnected</span>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="text-center mb-4">
                            <div class="display-1 mb-2">
                                <i class="bi bi-wifi" id="wifiClientIcon"></i>
                            </div>
                            <h5 id="wifiClientSSID">Not Connected</h5>
                        </div>
                        
                        <table class="table table-borderless">
                            <tr>
                                <td class="text-muted">Status:</td>
                                <td>
                                    <span class="badge bg-danger" id="wifiClientStatus">Disconnected</span>
                                </td>
                            </tr>
                            <tr>
                                <td class="text-muted">Signal:</td>
                                <td>
                                    <div class="progress mb-1" style="height: 10px;">
                                        <div class="progress-bar" id="wifiClientSignalBar" style="width: 0%"></div>
                                    </div>
                                    <span id="wifiClientSignal">0%</span>
                                </td>
                            </tr>
                            <tr>
                                <td class="text-muted">IP Address:</td>
                                <td class="fw-bold" id="wifiClientIP">—</td>
                            </tr>
                            <tr>
                                <td class="text-muted">Security:</td>
                                <td class="fw-bold" id="wifiClientSecurity">—</td>
                            </tr>
                            <tr>
                                <td class="text-muted">Channel:</td>
                                <td class="fw-bold" id="wifiClientChannel">—</td>
                            </tr>
                        </table>
                        
                        <button class="btn btn-danger w-100 mt-3" onclick="disconnectWiFi()" id="disconnectWiFiBtn" style="display: none;">
                            <i class="bi bi-wifi-off"></i> Disconnect
                        </button>
                    </div>
                </div>
            </div>

            <!-- Available Networks -->
            <div class="col-12 col-lg-7">
                <div class="card h-100">
                    <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="bi bi-search me-2"></i>Available Networks
                        </h5>
                        <button class="btn btn-sm btn-outline-primary" onclick="scanWiFiNetworks()">
                            <i class="bi bi-search"></i> Scan
                        </button>
                    </div>
                    <div class="card-body p-0">
                        <div class="list-group list-group-flush" id="wifiNetworksList" style="max-height: 400px; overflow-y: auto;">
                            <div class="text-center py-4">
                                <button class="btn btn-primary" onclick="scanWiFiNetworks()">
                                    <i class="bi bi-search"></i> Scan for Networks
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== SHARE INTERNET TAB ==================== -->
    <div class="tab-pane fade" id="hotspot" role="tabpanel">
        <div class="row g-4">
            <!-- WiFi Hotspot -->
            <div class="col-12 col-lg-6">
                <div class="card h-100">
                    <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="bi bi-wifi me-2"></i>WiFi Hotspot
                        </h5>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="hotspotToggle">
                            <label class="form-check-label" for="hotspotToggle">Enable</label>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="text-center mb-4">
                            <div class="display-1 mb-2">
                                <i class="bi bi-wifi" id="hotspotIcon"></i>
                            </div>
                            <h5 id="hotspotSSID">ESP32-S3-Hotspot</h5>
                        </div>
                        
                        <form id="hotspotForm" onsubmit="return false;">
                            <div class="mb-3">
                                <label class="form-label">SSID</label>
                                <input type="text" class="form-control" id="hotspotSsid" value="ESP32-S3-Hotspot">
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Password</label>
                                <div class="input-group">
                                    <input type="password" class="form-control" id="hotspotPassword" value="12345678">
                                    <button class="btn btn-outline-secondary" type="button" onclick="toggleHotspotPassword()">
                                        <i class="bi bi-eye"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="form-label">Security</label>
                                    <select class="form-select" id="hotspotSecurity">
                                        <option value="WPA2-PSK">WPA2-PSK</option>
                                        <option value="WPA3">WPA3</option>
                                        <option value="open">Open</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Band</label>
                                    <select class="form-select" id="hotspotBand">
                                        <option value="2.4GHz">2.4 GHz</option>
                                        <option value="5GHz">5 GHz</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="form-label">Channel</label>
                                    <input type="number" class="form-control" id="hotspotChannel" value="6" min="1" max="11">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Max Clients</label>
                                    <input type="number" class="form-control" id="hotspotMaxClients" value="10" min="1" max="50">
                                </div>
                            </div>
                            
                            <div class="mb-3 form-check">
                                <input type="checkbox" class="form-check-input" id="hotspotHidden">
                                <label class="form-check-label">Hide SSID</label>
                            </div>
                            
                            <button type="button" class="btn btn-primary w-100" onclick="saveHotspotConfig()">
                                <i class="bi bi-save"></i> Apply Hotspot Settings
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Connected Clients & USB Tethering -->
            <div class="col-12 col-lg-6">
                <!-- USB Tethering -->
                <div class="card mb-4">
                    <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="bi bi-usb-symbol me-2"></i>USB Tethering
                        </h5>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="usbToggle">
                            <label class="form-check-label" for="usbToggle">Enable</label>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <div class="flex-shrink-0 me-3">
                                <i class="bi bi-usb-symbol fs-1" id="usbIcon"></i>
                            </div>
                            <div class="flex-grow-1">
                                <h6 id="usbStatus">Disabled</h6>
                                <p class="mb-0 small text-muted" id="usbDetails">Connect USB cable to share internet</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Connected Hotspot Clients -->
                <div class="card">
                    <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="bi bi-people me-2"></i>Connected Clients
                        </h5>
                        <span class="badge bg-primary" id="clientCount">0</span>
                    </div>
                    <div class="card-body p-0">
                        <div class="list-group list-group-flush" id="clientsList" style="max-height: 250px; overflow-y: auto;">
                            <div class="text-center py-4 text-muted">
                                No clients connected
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== ROUTING TAB ==================== -->
    <div class="tab-pane fade" id="routing" role="tabpanel">
        <div class="row g-4">
            <!-- Routing Status -->
            <div class="col-12 col-lg-6">
                <div class="card h-100">
                    <div class="card-header bg-white py-3">
                        <h5 class="mb-0">
                            <i class="bi bi-diagram-3 me-2"></i>Routing Status
                        </h5>
                    </div>
                    <div class="card-body">
                        <table class="table table-borderless">
                            <tr>
                                <td class="text-muted">Primary Source:</td>
                                <td class="fw-bold" id="routingSource">None</td>
                            </tr>
                            <tr>
                                <td class="text-muted">Default Gateway:</td>
                                <td class="fw-bold" id="routingGateway">—</td>
                            </tr>
                            <tr>
                                <td class="text-muted">NAT Enabled:</td>
                                <td>
                                    <span class="badge bg-success" id="routingNat">Yes</span>
                                </td>
                            </tr>
                            <tr>
                                <td class="text-muted">Firewall:</td>
                                <td>
                                    <span class="badge bg-success" id="routingFirewall">Enabled</span>
                                </td>
                            </tr>
                            <tr>
                                <td class="text-muted">Failover:</td>
                                <td>
                                    <span class="badge bg-secondary" id="routingFailover">Disabled</span>
                                </td>
                            </tr>
                            <tr>
                                <td class="text-muted">Load Balancing:</td>
                                <td>
                                    <span class="badge bg-secondary" id="routingBalancing">Disabled</span>
                                </td>
                            </tr>
                            <tr>
                                <td class="text-muted">Connected Devices:</td>
                                <td class="fw-bold" id="routingDevices">0</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Routing Configuration -->
            <div class="col-12 col-lg-6">
                <div class="card h-100">
                    <div class="card-header bg-white py-3">
                        <h5 class="mb-0">
                            <i class="bi bi-gear me-2"></i>Routing Configuration
                        </h5>
                    </div>
                    <div class="card-body">
                        <form id="routingForm" onsubmit="return false;">
                            <div class="mb-3 form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="routingFailoverCheck">
                                <label class="form-check-label" for="routingFailoverCheck">
                                    Enable Failover (Auto switch between sources)
                                </label>
                            </div>
                            
                            <div class="mb-3 form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="routingBalancingCheck">
                                <label class="form-check-label" for="routingBalancingCheck">
                                    Enable Load Balancing (Use multiple sources)
                                </label>
                                <small class="text-muted d-block">Combine mobile data and WiFi for faster speeds</small>
                            </div>
                            
                            <div class="mb-3 form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="routingNatCheck" checked>
                                <label class="form-check-label" for="routingNatCheck">
                                    Enable NAT (Network Address Translation)
                                </label>
                            </div>
                            
                            <div class="mb-3 form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="routingFirewallCheck" checked>
                                <label class="form-check-label" for="routingFirewallCheck">
                                    Enable Firewall
                                </label>
                            </div>
                            
                            <button type="button" class="btn btn-primary w-100" onclick="saveRoutingConfig()">
                                <i class="bi bi-save"></i> Apply Routing Settings
                            </button>
                        </form>
                        
                        <hr>
                        
                        <h6 class="fw-bold mb-3">Current Internet Path</h6>
                        <div class="bg-light p-3 rounded" id="internetPath">
                            <div class="d-flex align-items-center mb-2">
                                <i class="bi bi-arrow-right-circle-fill text-success me-2"></i>
                                <span>Mobile Data: <span id="pathMobile">Not Connected</span></span>
                            </div>
                            <div class="d-flex align-items-center mb-2">
                                <i class="bi bi-arrow-right-circle-fill text-success me-2"></i>
                                <span>WiFi Client: <span id="pathWiFi">Not Connected</span></span>
                            </div>
                            <div class="d-flex align-items-center">
                                <i class="bi bi-arrow-right-circle-fill text-success me-2"></i>
                                <span>USB: <span id="pathUSB">Not Connected</span></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Data Usage -->
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="bi bi-bar-chart me-2"></i>Data Usage
                        </h5>
                        <button class="btn btn-sm btn-outline-danger" onclick="resetDataUsage()">
                            <i class="bi bi-arrow-counterclockwise"></i> Reset Counters
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-4 mb-3">
                                <div class="border rounded p-3">
                                    <small class="text-muted">Total Sent</small>
                                    <h4 id="totalSent">0 MB</h4>
                                </div>
                            </div>
                            <div class="col-4 mb-3">
                                <div class="border rounded p-3">
                                    <small class="text-muted">Total Received</small>
                                    <h4 id="totalReceived">0 MB</h4>
                                </div>
                            </div>
                            <div class="col-4 mb-3">
                                <div class="border rounded p-3">
                                    <small class="text-muted">Total Usage</small>
                                    <h4 id="totalUsage">0 MB</h4>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-6">
                                <div class="border rounded p-3">
                                    <h6>Mobile Data</h6>
                                    <div class="d-flex justify-content-between">
                                        <span>Sent:</span>
                                        <span id="mobileSent">0 MB</span>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <span>Received:</span>
                                        <span id="mobileReceived">0 MB</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="border rounded p-3">
                                    <h6>WiFi Data</h6>
                                    <div class="d-flex justify-content-between">
                                        <span>Sent:</span>
                                        <span id="wifiSent">0 MB</span>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <span>Received:</span>
                                        <span id="wifiReceived">0 MB</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- WiFi Connect Modal -->
<div class="modal fade" id="wifiConnectModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-wifi me-2"></i>Connect to WiFi
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="wifiConnectForm" onsubmit="return false;">
                    <input type="hidden" id="connectSsid">
                    
                    <div class="mb-3">
                        <label class="form-label">Network</label>
                        <input type="text" class="form-control" id="connectSsidDisplay" readonly>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Security</label>
                        <input type="text" class="form-control" id="connectSecurity" readonly>
                    </div>
                    
                    <div class="mb-3" id="passwordField">
                        <label class="form-label">Password</label>
                        <div class="input-group">
                            <input type="password" class="form-control" id="connectPassword">
                            <button class="btn btn-outline-secondary" type="button" onclick="toggleConnectPassword()">
                                <i class="bi bi-eye"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="mb-3 d-none" id="enterpriseFields">
                        <label class="form-label">Username</label>
                        <input type="text" class="form-control" id="connectUsername">
                        
                        <label class="form-label mt-2">Identity</label>
                        <input type="text" class="form-control" id="connectIdentity">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="connectToWiFi()">Connect</button>
            </div>
        </div>
    </div>
</div>

<!-- Load script -->
<script src="/js/modem.js"></script>

<style>
.nav-tabs .nav-link {
    color: #495057;
    font-weight: 500;
}

.nav-tabs .nav-link.active {
    color: #0d6efd;
    font-weight: 600;
}

.progress {
    background-color: #e9ecef;
    border-radius: 10px;
}

.progress-bar {
    border-radius: 10px;
}

.list-group-item {
    cursor: pointer;
    transition: all 0.2s;
}

.list-group-item:hover {
    background-color: #f8f9fa;
}

.list-group-item.active {
    background-color: #0d6efd;
    color: white;
    border-color: #0d6efd;
}

@media (max-width: 767.98px) {
    .form-switch {
        padding-left: 2.5em;
    }
}
</style>